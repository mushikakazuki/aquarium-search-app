// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Prefecture {
  Hokkaido
  Aomori
  Iwate
  Miyagi
  Akita
  Yamagata
  Fukushima
  Ibaraki
  Tochigi
  Gunma
  Saitama
  Chiba
  Tokyo
  Kanagawa
  Niigata
  Toyama
  Ishikawa
  Fukui
  Yamanashi
  Nagano
  Gifu
  Shizuoka
  Aichi
  Mie
  Shiga
  Kyoto
  Osaka
  Hyogo
  Nara
  Wakayama
  Tottori
  Shimane
  Okayama
  Hiroshima
  Yamaguchi
  Tokushima
  Kagawa
  Ehime
  Kochi
  Fukuoka
  Saga
  Nagasaki
  Kumamoto
  Oita
  Miyazaki
  Kagoshima
  Okinawa
}

// 水族館
model Aquarium {
  id Int @id @default(autoincrement())
  name String
  name_kana String?
  prefectures Prefecture
  address String
  latitude Float
  longitude Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  aquariumInfo AquariumInfo?
  organisms   AquariumOrganism[]
  prices      Price[]
  hours       OpeningHour[]
  shows       Show[]
  tags        AquariumTag[]
  comments    Comment[]
  accessInfos AccessInfo[]
  images      Image[]
  favorites   Favorite[]
}

// 水族館補足情報
model AquariumInfo {
  id Int @id @default(autoincrement())
  aquariumId Int @unique
  officialWebsiteURL String?
  timeRequired Int?
  isJAZAFlag Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  aquarium Aquarium @relation(fields: [aquariumId], references: [id])
}

// 代表生物
model AquariumOrganism {
  id Int @id @default(autoincrement())
  aquariumId Int
  name       String

  aquarium Aquarium @relation(fields: [aquariumId], references: [id])
}

model PriceType {
  id Int @id @default(autoincrement())
  type String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  prices Price[]
}

// 料金
model Price {
  id Int @id @default(autoincrement())
  aquariumId Int
  priceTypeId Int
  price      Int
  note       String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  aquarium   Aquarium @relation(fields: [aquariumId], references: [id])
  priceType  PriceType @relation(fields: [priceTypeId], references: [id])
}

// 営業時間
model OpeningHour {
  id Int @id @default(autoincrement())
  aquariumId Int
  dayOfWeek  String   // 月〜日 / 祝
  isClosed  Boolean @default(false)
  openTime   DateTime
  closeTime  DateTime
  note       String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  aquarium   Aquarium @relation(fields: [aquariumId], references: [id])
}

// ショー
model Show {
  id Int @id @default(autoincrement())
  aquariumId    Int
  name          String
  timeRequired Int?
  location      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  aquarium   Aquarium @relation(fields: [aquariumId], references: [id])
}

// タグ
model Tag {
  id        Int   @id @default(autoincrement())
  name      String
  type      String   // 特徴/設備/展示生物
  sortOrder Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  aquariumTag AquariumTag[]
}

// 中間（水族館_タグ）
model AquariumTag {
  id Int @id @default(autoincrement())
  aquariumId Int
  tagId      Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  aquarium   Aquarium @relation(fields: [aquariumId], references: [id])
  tag        Tag      @relation(fields: [tagId], references: [id])
}

// ユーザー
model User {
  id Int @id @default(autoincrement())
  anonId      String   // guest_id cookie 用
  displayName String
  email       String?  // パスワードレス用
  trusted     Boolean  @default(false)
  createdAt   DateTime @default(now())

  // リレーション
  comments    Comment[]
  favorites   Favorite[]
}

// コメント
model Comment {
  id Int @id @default(autoincrement())
  aquariumId  Int
  userId      Int
  aquarium    Aquarium @relation(fields: [aquariumId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
  rating      Int
  body        String
  status      String   // 保留/公開/非表示
  likes       Int      @default(0)
  dislikes    Int      @default(0)
  reports     Int      @default(0)
  editToken   String
  ipHash      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// アクセス情報
model AccessInfo {
  id Int @id @default(autoincrement())
  aquariumId  Int
  aquarium    Aquarium @relation(fields: [aquariumId], references: [id])
  stationName String
  walkMinutes Int?
  busRoutes   String?
  parking     Int?
  parkingFee  Int?
  note        String?
  updatedAt   DateTime @updatedAt
}

// 画像
model Image {
  id Int @id @default(autoincrement())
  aquariumId  Int
  aquarium    Aquarium @relation(fields: [aquariumId], references: [id])
  url         String
  credit      String?
  sourceUrl   String?
  license     String
  altText     String?
  sortOrder   Int      @default(0)
  updatedAt   DateTime @updatedAt
}

// お気に入り
model Favorite {
  id Int @id @default(autoincrement())
  userId     Int
  aquariumId Int
  user       User     @relation(fields: [userId], references: [id])
  aquarium   Aquarium @relation(fields: [aquariumId], references: [id])
  createdAt  DateTime @default(now())
}